# コンピューティングソリューション
## VM
### サイズ
- 汎用: B, D.
- コンピューティング最適化: F.
- メモリ最適化: E., M., D.
  - DB
- ストレージ最適化: Ls.
  - NoSQL
- GPU: N.
- ハイパフォーマンスコンピューティング: H.

### 価格
- コンピューティングとストレージに対して課金が発生する
- OS のライセンスの価格も入っている

## Batch
- コンピューティング集中型のタスクをスケジュール
- コンピューティングノードの作成および管理
- HPC ワークロード
- 入力ファイルとアプリケーションをストレージアカウントにアップロードする
- ジョブを少なくし, タスクを多くすることが推奨されている
  - タスク: ジョブを構成する作業単位

## Container Instances
- コンテナ化可能な場合は App Service ではなく Container Instances を使う
- **スケーリングはサポートされない**
  - スケーリングが必要な場合は Contaier Apps を使用する

### コンテナ―グループ
- 同じコンピュータでホストされるコンテナーの集合
- ライフサイクル, リソース, ローカルネットワーク, ストレージボリュームを共有する

### VM との比較
- 分離の度合いは弱い
  - VM では他の VM から完全に分離される
- Docker 個々のコンテナーをデプロイする

## Container Apps
- **インスタンスを追加し自動的にスケールする**
  - HTTP 要求数, TCP 接続数, その他カスタムイベントなどによってトリガーされる
  - [Azure Container Apps でスケーリング ルールを設定する](https://learn.microsoft.com/ja-jp/azure/container-apps/scale-app?pivots=azure-cli)
- *ゾーン冗長をサポートする[要検証]*

## Funcstions
- デプロイする際にストレージアカウントが必要
  - コードなどを保存するため


# アプリケーションアーキテクチャの設計
## メッセージング
- **メッセージ**は, あるコンポーネントによって生成され, **別のコンポーネントによって使用される**ことが想定される

### Queue Storage
- メッセージを格納する(数百万)
- **At-Least-Once** 配信保証
- 順序は保証されない
- シナリオ例
  - キューを通るすべてのメッセージの監査証跡が必要
  - キュー ストレージが 80 GB を超えると予想している
  - キュー内のメッセージ処理の進行状況を追跡したい

### Service Bus
- アプリケーションとサービスを分離するメッセージブローカー
- メッセージキューとパブリッシュ/サブスクライブのトピックがサポートされる
  - メッセージキュー: ターゲットで受信の準備ができるまでメッセージを保持する
    - 順序の保証あり(FIFO)
    - **At-Most-Once** 配信保証
    - その他, トランザクションのグループ化, バッチ発行なども可
    - **Queue Storage よりも高度なメッセージ処理が可能**
  - パブリッシュ - サブスクライブトピック: 複数のサブスクライバーが存在できる
  
### Event Hubs
- 1 秒あたり数百万のイベントを受信して処理できる
- リアルタイムのインジェストとマイクロサービスのバッチ処理が**同じストリームで**サポートされる
- プルモデルを実装
  - Event Hubs では各メッセージをキャッシュに保持して読み取れるようにする
  - 読み取り時にメッセージが削除されない(他のコンシューマーのために残される)
- 購入した処理ユニットの数に応じてスケーリングする
- 処理されないメッセージは残される
- **リアルタイムの分析とアーカイブデータを使用したトランザクションの処理**に適するサービス
  - 異常の検出など

## イベント
- **イベント**は, 処理されることもあるし, されないこともある(**アクションを予期しない**)

### Event Grid
- 複数のデータソースから送信されたイベントが集約される

#### Event Grid の仕組み
- イベントハンドラーは, 関心のあるトピックにサブスクライブする
- イベントソースは, イベントにタグを付与して Event Grid に送信する
- Event Grid は, トピックタグを調べてイベントの配信先のハンドラーを決定し, イベントを転送する

## キャッシュ
### Cache for Redis

## API Management
- 複数の API を発行, セキュリティ保護, 保守, 分析できる
  - バージョン管理
  - 仕様の標準化
- API のフロントドアとして機能する
  - API はバックエンドのサーバーに存在する

## アプリデプロイソリューション
### Resource Manager
- JSON と Bicep の形式をサポート
  - Bicep -> JSON にコンパイルされる
  - JSON -> Bicep への逆コンパイルは Bicep CLI で可能

### Automation
- プロセスの自動化, 構成管理, 更新管理などをサポート


## App Configuration
- アプリケーションの設定を一元管理


# ネットワークソリューションを設計する
## 仮想ネットワーク
- 仮想ネットワークのアドレス空間はオンプレミスのネットワーク範囲と重複しないようにする
  - どうしても重複する場合は NAT を使う
- ハブスポークトポロジでスポーク間の接続を有効するにはハブの仮想ネットワークにルーター(Firewall など)が必要
- **どのネットワーク構成においても, Firewall による制御が推奨される**(一元管理が可能なため)

## Virtual Network NAT

## ルーティングテーブル
- サービスエンドポイントを有効化すると, そのサービスの*パブリック IP アドレス[要検証]*がテーブルに追加される
- テーブルのエントリが競合する場合は**プレフィックスの最長一致**に基づいてネクストホップを選択する

## 負荷分散
- *インターネットに接続されていないアプリケーションでは Application Gateway が推奨される[要検証]*


# 移行を設計する
## Migrate
- TCO 計算ツール: 移行前にコストを見積もる

### Web アプリの移行
- App Service Migration Assistant を使用
  - Windows ASP.NET Web アプリの評価と App Service への移行が可能

### 仮想マシンの移行
- **Server Migration** を使用

### データベース内の構造化データの移行
- **Database Migration Service** を使用
  - オンプレミスのデータベースを SQL Database, SQL Managed Instance または VM 上の SQL Server に移行
- データ移行の方法:
  - **オンライン移行**
    - ダウンタイムを最小限に抑えられる
    - **SQL Managed Instance のみ**
  - **オフライン移行**
    - サーバのシャットダウンが必要, ダウンタイムが発生する

#### SQL Server Data Migration Assistant(DMA)
- データベースの評価, スキーマの移行, データの移行と検証が実行される

#### 移行手順
1. オンプレミスデータベースを DMA で評価する
2. DMA でスキーマを移行する
  - 移行先データベースに空の構造が作成される
  - データ移行前に接続が検証される
3. Data Migration Service でデータを移行し, 検証する

### 非構造化データの移行
#### Storage Migration Service
- サーバーを新しいハードウェアまたは仮想マシンに移行するさいに使用する

#### File Sync
- 組織のファイル共有を一元化
- バックアップ用またはディザスターリカバリー用のストレージとして使用できる

### オフラインデータの移行
- データが多くないときには AzCopy や Azure Storage Explorer を使用する

#### Import/Export
- Import は BLOB と Files でサポートされる
- Export は BLOB のみ
- BitLocker を有効化する必要がある

#### Data Box
- 専用デバイスを受け取って, オンプレミス環境でデータの送受信を行う
  - Import/Export では自己所有ディスクを使うのに対し, Data Box では専用デバイスを注文して使用する
- **Microsoft が出荷と物流を処理する**
- 40 TB を超えるデータの転送に適する